!function(t,e){"use strict";function i(t){this.viewport=t,this.parent=t.parentNode,this.initialize()}var s={38:"previous",40:"next",72:"nav",83:"focus",84:"toggle"};i.prototype.initialize=function(){this.content=this.viewport.getElementsByTagName("section")[0],this.articles=this.content.getElementsByTagName("article"),this.initFrame().initNav(),t.addEventListener("resize",this.redraw.bind(this)),t.addEventListener("keydown",this.hotkeys.bind(this))},i.prototype.setAttributes=Atomic.prototype.setAttributes,i.prototype.text=function(t){return t.innerText||t.textContent},i.prototype.redraw=function(){this.setAttributes(this.frame,{height:this.parent.offsetHeight+"px",width:this.parent.offsetWidth+"px"})},i.prototype.initFrame=function(){var t=this.frame=e.createElement("iframe");return this.setAttributes(t,{seamless:!0,height:this.parent.offsetHeight+"px",width:this.parent.offsetWidth+"px",src:this.viewport.getAttribute("data-load")}),this.viewport.insertBefore(t,this.viewport.firstChild),this},i.prototype.initNav=function(){for(var i,s,n=["<input type=text value=0 readonly><ol>","</ol><canvas></canvas>"],r=this.setAttributes(e.createElement("section"),{"class":"atomic"}),a=this.viewport.getElementsByTagName("nav")[0],o=(t.getComputedStyle(this.articles[0]),this.articles.length),h=o;h--;)s=this.articles[h],i=s.getElementsByTagName("h1")[0],n.splice(1,0,"<li><label>"+this.text(i)+"</label></li>"),s.appendChild(this.setAttributes(e.createElement("label"),{"for":"i"+h}));for(r.innerHTML=n.join(""),a.appendChild(r),this.index=-1,this.searchbox=a.getElementsByTagName("input")[0],this.atomic=new Atomic(r,this.viewport),this.max=o-1;o--;)this.atomic.radio[o].addEventListener("change",this.update.bind(this,o));return a.getElementsByTagName("form")[0].addEventListener("submit",this.search.bind(this)),this},i.prototype.search=function(t){t.preventDefault();var e,i,s,n=this.searchbox.value,r=this.articles.length,a=new RegExp("("+n+")","ig");if(n)for(;r--;)if(e=this.articles[r],a.test(this.text(e)))for(i=e.getElementsByTagName("*"),s=i.length;s--;)i[s].innerHTML=this.text(i[s]).replace(a,"<mark>$1</mark>")},i.prototype.render=function(){this.reset().atomic.update(this.atomic.radio[this.index].value)},i.prototype.update=function(t){this.reset(),this.index=t},i.prototype.previous=function(){--this.index<0&&(this.index=0),this.render()},i.prototype.next=function(){++this.index>this.max&&(this.index=this.max),this.render()},i.prototype.toggle=function(){e.activeElement!==this.searchbox&&this.setClass(~this.viewport.getAttribute("class").indexOf("hide")?"":"hide")},i.prototype.setClass=function(t){return this.viewport.setAttribute("class","dawn "+t),this},i.prototype.nav=function(){e.activeElement!==this.searchbox&&this.setClass(~this.viewport.getAttribute("class").indexOf("nav")?"":"nav")},i.prototype.focus=function(t){var i=e.activeElement;i!==this.searchbox&&this.searchbox&&(t.preventDefault(),this.setClass("nav").searchbox.focus())},i.prototype.reset=function(){return this.searchbox.blur(),this.viewport.setAttribute("class","dawn"),this},i.prototype.hotkeys=function(t){s[t.keyCode]&&this[s[t.keyCode]].call(this,t)},i.instance=new i(document.getElementsByClassName("dawn")[0]),t.Dawn=i}(window,document);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRhd24uanMiXSwibmFtZXMiOlsidyIsImQiLCJEYXduIiwidmlld3BvcnQiLCJ0aGlzIiwicGFyZW50IiwicGFyZW50Tm9kZSIsImluaXRpYWxpemUiLCJtYXAiLDM4LDQwLDcyLDgzLDg0LCJwcm90b3R5cGUiLCJjb250ZW50IiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJhcnRpY2xlcyIsImluaXRGcmFtZSIsImluaXROYXYiLCJhZGRFdmVudExpc3RlbmVyIiwicmVkcmF3IiwiYmluZCIsImhvdGtleXMiLCJzZXRBdHRyaWJ1dGVzIiwiQXRvbWljIiwidGV4dCIsImVsZW1lbnQiLCJpbm5lclRleHQiLCJ0ZXh0Q29udGVudCIsImZyYW1lIiwiaGVpZ2h0Iiwib2Zmc2V0SGVpZ2h0Iiwid2lkdGgiLCJvZmZzZXRXaWR0aCIsImNyZWF0ZUVsZW1lbnQiLCJzZWFtbGVzcyIsInNyYyIsImdldEF0dHJpYnV0ZSIsImluc2VydEJlZm9yZSIsImZpcnN0Q2hpbGQiLCJ0aXRsZSIsImFydGljbGUiLCJwYXJ0cyIsImF0b20iLCJjbGFzcyIsIm5hdiIsIm4iLCJnZXRDb21wdXRlZFN0eWxlIiwibGVuZ3RoIiwiaSIsInNwbGljZSIsImFwcGVuZENoaWxkIiwiZm9yIiwiaW5uZXJIVE1MIiwiam9pbiIsImluZGV4Iiwic2VhcmNoYm94IiwiYXRvbWljIiwibWF4IiwicmFkaW8iLCJ1cGRhdGUiLCJzZWFyY2giLCJlIiwicHJldmVudERlZmF1bHQiLCJhbGwiLCJ2IiwidmFsdWUiLCJyZWdleHAiLCJSZWdFeHAiLCJ0ZXN0IiwicmVwbGFjZSIsInJlbmRlciIsInJlc2V0IiwicHJldmlvdXMiLCJuZXh0IiwidG9nZ2xlIiwiYWN0aXZlRWxlbWVudCIsInNldENsYXNzIiwiaW5kZXhPZiIsImNsYXNzTmFtZSIsInNldEF0dHJpYnV0ZSIsImZvY3VzIiwiYWN0aXZlIiwiYmx1ciIsImtleUNvZGUiLCJjYWxsIiwiaW5zdGFuY2UiLCJkb2N1bWVudCIsImdldEVsZW1l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RTdFLEVBQUtZLFVBQVVvRSxNQUFRLFNBQWVuQixHQUNwQyxHQUFJb0IsR0FBU2xGLEVBQUU0RSxhQUNYTSxLQUFXL0UsS0FBS3FELFdBQWNyRCxLQUFLcUQsWUFFdkNNLEVBQUVDLGlCQUNGNUQsS0FBSzBFLFNBQVMsT0FBT3JCLFVBQVV5QixVQVNqQ2hGLEVBQUtZLFVBQVUyRCxNQUFRLFdBR3JCLE1BRkFyRSxNQUFLcUQsVUFBVTJCLE9BQ2ZoRixLQUFLRCxTQUFTOEUsYUFBYSxRQUFTLFFBQzdCN0UsTUFTVEYsRUFBS1ksVUFBVVMsUUFBVSxTQUFpQndDLEdBQ3BDdkQsRUFBSXVELEVBQUVzQixVQUFVakYsS0FBS0ksRUFBSXVELEVBQUVzQixVQUFVQyxLQUFLbEYsS0FBTTJELElBSXREN0QsRUFBS3FGLFNBQVcsR0FBSXJGLEdBQUtzRixTQUFTQyx1QkFBdUIsUUFBUSxJQUdqRXpGLEVBQUVFLEtBQU9BLEdBQ1J3RixPQUFRRiIsImZpbGUiOiJlb3MubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGluaXREYXduKHcsIGQpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIC8qKlxuICAgKiBLZXlDb2RlcyBtYXBwZWQgdG8gZnVuY3Rpb25zLlxuICAgKlxuICAgKiBAdHlwZSB7QXJyYXl9XG4gICAqIEBhcGkgcHJpdmF0ZVxuICAgKi9cbiAgdmFyIG1hcCA9IHtcbiAgICAgIDM4OiAncHJldmlvdXMnXG4gICAgLCA0MDogJ25leHQnXG4gICAgLCA3MjogJ25hdidcbiAgICAsIDgzOiAnZm9jdXMnXG4gICAgLCA4NDogJ3RvZ2dsZSdcbiAgfTtcblxuICAvKipcbiAgICogSW5pdGlhbGl6ZSBnZXR0aW5nIHN0YXJ0ZWQuXG4gICAqXG4gICAqIEBDb25zdHJ1Y3RvclxuICAgKiBAcGFyYW0ge0VsZW1lbnR9IHN0YXJ0XG4gICAqIEBhcGkgcHVibGljXG4gICAqL1xuICBmdW5jdGlvbiBEYXduKHZpZXdwb3J0KSB7XG4gICAgdGhpcy52aWV3cG9ydCA9IHZpZXdwb3J0O1xuICAgIHRoaXMucGFyZW50ID0gdmlld3BvcnQucGFyZW50Tm9kZTtcblxuICAgIHRoaXMuaW5pdGlhbGl6ZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEluaXRpYWxpemUgdGhlIGlmcmFtZSwgbG9hZCB0aGUgd2Vic2l0ZSBhbmQgYWRkIHRoZSBuYXZpZ2F0aW9uLlxuICAgKlxuICAgKiBAcGFyYW0ge0VsZW1lbnR9IHN0YXJ0XG4gICAqIEBhcGkgcHVibGljXG4gICAqL1xuICBEYXduLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHtcbiAgICAvLyBHZXQgdGhlIGNvbnRlbnQgYW5kIGl0cyBhcnRpY2xlcy5cbiAgICB0aGlzLmNvbnRlbnQgPSB0aGlzLnZpZXdwb3J0LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzZWN0aW9uJylbMF07XG4gICAgdGhpcy5hcnRpY2xlcyA9IHRoaXMuY29udGVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYXJ0aWNsZScpO1xuXG4gICAgLy8gSW5pdGlhbGl6ZSB0aGUgaWZyYW1lLCBuYXZpZ2F0aW9uIGFuZCBoaWRkZW4gY29udHJvbHMuXG4gICAgdGhpcy5pbml0RnJhbWUoKS5pbml0TmF2KCk7XG5cbiAgICAvLyBDaGFuZ2UgdGhlIGRpbWVuc2lvbnMgb2YgdGhlIGlmcmFtZSBvbiB3aW5kb3cgcmVzaXplLlxuICAgIHcuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhpcy5yZWRyYXcuYmluZCh0aGlzKSk7XG5cbiAgICAvLyBMaXN0ZW4gdG8ga2V5cHJlc3NlcyBhbmQgZGV0ZXJtaW5lIFVJIGFjdGlvbnMuXG4gICAgdy5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5ob3RrZXlzLmJpbmQodGhpcykpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBQcm94eSBzZXRBdHRyaWJ1dGUgZnJvbSBBdG9taWMuXG4gICAqXG4gICAqIEBhcGkgcHJpdmF0ZVxuICAgKi9cbiAgRGF3bi5wcm90b3R5cGUuc2V0QXR0cmlidXRlcyA9IEF0b21pYy5wcm90b3R5cGUuc2V0QXR0cmlidXRlcztcblxuICAvKipcbiAgICogR2V0IHRleHQgZnJvbSB0aGUgZWxlbWVudC5cbiAgICpcbiAgICogQHJldHVybnMge1N0cmluZ30gdGV4dFxuICAgKiBAYXBpIHByaXZhdGVcbiAgICovXG4gIERhd24ucHJvdG90eXBlLnRleHQgPSBmdW5jdGlvbiB0ZXh0KGVsZW1lbnQpIHtcbiAgICByZXR1cm4gZWxlbWVudC5pbm5lclRleHQgfHwgZWxlbWVudC50ZXh0Q29udGVudDtcbiAgfTtcblxuICAvKipcbiAgICogQ2hhbmdlIGRpbWVuc2lvbnMgb2YgdGhlIGlmcmFtZSwgZm9yIGluc3RhbmNlIG9uIHdpbmRvdyByZXNpemUuXG4gICAqXG4gICAqIEBhcGkgcHJpdmF0ZVxuICAgKi9cbiAgRGF3bi5wcm90b3R5cGUucmVkcmF3ID0gZnVuY3Rpb24gcmVkcmF3KCkge1xuICAgIHRoaXMuc2V0QXR0cmlidXRlcyh0aGlzLmZyYW1lLCB7XG4gICAgICAgIGhlaWdodDogdGhpcy5wYXJlbnQub2Zmc2V0SGVpZ2h0ICsgJ3B4J1xuICAgICAgLCB3aWR0aDogdGhpcy5wYXJlbnQub2Zmc2V0V2lkdGggKyAncHgnXG4gICAgfSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIFNldHVwIHRoZSBpZnJhbWUgYW5kIHRoZSBjb250ZW50LlxuICAgKlxuICAgKiBAcmV0dXJucyB7RGF3bn0gZmx1ZW50IGludGVyZmFjZVxuICAgKiBAYXBpIHByaXZhdGVcbiAgICovXG4gIERhd24ucHJvdG90eXBlLmluaXRGcmFtZSA9IGZ1bmN0aW9uIGluaXRGcmFtZSgpIHtcbiAgICB2YXIgZnJhbWUgPSB0aGlzLmZyYW1lID0gZC5jcmVhdGVFbGVtZW50KCdpZnJhbWUnKTtcblxuICAgIC8vIFNldCB0aGUgYXR0cmlidXRlcyBhbmQgaW5zZXJ0IHRoZSBpZnJhbWUgaW4gRGF3bi5cbiAgICB0aGlzLnNldEF0dHJpYnV0ZXMoZnJhbWUsIHtcbiAgICAgICAgc2VhbWxlc3M6IHRydWVcbiAgICAgICwgaGVpZ2h0OiB0aGlzLnBhcmVudC5vZmZzZXRIZWlnaHQgKyAncHgnXG4gICAgICAsIHdpZHRoOiB0aGlzLnBhcmVudC5vZmZzZXRXaWR0aCArICdweCdcbiAgICAgICwgc3JjOiB0aGlzLnZpZXdwb3J0LmdldEF0dHJpYnV0ZSgnZGF0YS1sb2FkJylcbiAgICB9KTtcblxuICAgIHRoaXMudmlld3BvcnQuaW5zZXJ0QmVmb3JlKGZyYW1lLCB0aGlzLnZpZXdwb3J0LmZpcnN0Q2hpbGQpO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplIHRoZSBuYXZpZ2F0aW9uIGFuZCB0aGUgQXRvbWljIHByb2dyZXNzIGJhci5cbiAgICpcbiAgICogQHJldHVybnMge0Rhd259IGZsdWVudCBpbnRlcmZhY2VcbiAgICogQGFwaSBwcml2YXRlXG4gICAqL1xuICBEYXduLnByb3RvdHlwZS5pbml0TmF2ID0gZnVuY3Rpb24gaW5pdE5hdigpIHtcbiAgICB2YXIgcGFydHMgPSBbJzxpbnB1dCB0eXBlPXRleHQgdmFsdWU9MCByZWFkb25seT48b2w+JywgJzwvb2w+PGNhbnZhcz48L2NhbnZhcz4nXVxuICAgICAgLCBhdG9tID0gdGhpcy5zZXRBdHRyaWJ1dGVzKGQuY3JlYXRlRWxlbWVudCgnc2VjdGlvbicpLCB7IGNsYXNzOiAnYXRvbWljJyB9KVxuICAgICAgLCBuYXYgPSB0aGlzLnZpZXdwb3J0LmdldEVsZW1lbnRzQnlUYWdOYW1lKCduYXYnKVswXVxuICAgICAgLCBzdHlsZSA9IHcuZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzLmFydGljbGVzWzBdKVxuICAgICAgLCBuID0gdGhpcy5hcnRpY2xlcy5sZW5ndGhcbiAgICAgICwgaSA9IG5cbiAgICAgICwgY29udHJvbCwgdGl0bGUsIGFydGljbGU7XG5cbiAgICB3aGlsZSAoaS0tKSB7XG4gICAgICBhcnRpY2xlID0gdGhpcy5hcnRpY2xlc1tpXTtcbiAgICAgIHRpdGxlID0gYXJ0aWNsZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaDEnKVswXTtcbiAgICAgIHBhcnRzLnNwbGljZSgxLCAwLCAnPGxpPjxsYWJlbD4nICsgdGhpcy50ZXh0KHRpdGxlKSArICc8L2xhYmVsPjwvbGk+Jyk7XG5cbiAgICAgIC8vIEFkZCBsYWJlbHMgZm9yIGVhY2ggYXJ0aWNsZSBwYW5lbC5cbiAgICAgIGFydGljbGUuYXBwZW5kQ2hpbGQoXG4gICAgICAgIHRoaXMuc2V0QXR0cmlidXRlcyhkLmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJyksIHsgZm9yOiAnaScgKyBpIH0pXG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIEFkZCB0aGUgZWxlY3Ryb25zIGFuZCBhZGQgQXRvbWljIHRvIHRoZSBET00gYmVmb3JlIGNvbnN0cnVjdGluZyxcbiAgICAvLyBvdGhlcndpc2UgZ2V0Q29tcHV0ZWRTdHlsZSB3aWxsIGZhaWwgYXMgaXQgaXMgbm90IGF0dGFjaGVkIHRvIHRoZSBET00uXG4gICAgYXRvbS5pbm5lckhUTUwgPSBwYXJ0cy5qb2luKCcnKTtcbiAgICBuYXYuYXBwZW5kQ2hpbGQoYXRvbSk7XG5cbiAgICAvLyBLZWVwIHRyYWNrIG9mIHRoZSBjdXJyZW50IHN0ZXAgYW5kIG1heCBzdGVwcy5cbiAgICB0aGlzLmluZGV4ID0gLTE7XG4gICAgdGhpcy5zZWFyY2hib3ggPSBuYXYuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2lucHV0JylbMF07XG4gICAgdGhpcy5hdG9taWMgPSBuZXcgQXRvbWljKGF0b20sIHRoaXMudmlld3BvcnQpO1xuICAgIHRoaXMubWF4ID0gbiAtIDE7XG5cbiAgICAvLyBMaXN0ZW4gdG8gY2hhbmdlIGV2ZW50cyBpbiB0aGUgcmFkaW8gYnV0dG9ucyBhbmQgbWl0aWdhdGUgdG8gdXBkYXRlLlxuICAgIHdoaWxlIChuLS0pIHRoaXMuYXRvbWljLnJhZGlvW25dLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHRoaXMudXBkYXRlLmJpbmQodGhpcywgbikpO1xuXG4gICAgLy8gTGlzdGVuIHRvIHNlYXJjaGVzLlxuICAgIG5hdi5nZXRFbGVtZW50c0J5VGFnTmFtZSgnZm9ybScpWzBdLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIHRoaXMuc2VhcmNoLmJpbmQodGhpcykpO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8qKlxuICAgKiBTZWFyY2ggdGhlIGNvbnRlbnQgb2YgZWFjaCBhcnRpY2xlIGFuZCBoaWdobGlnaHQgdGhlIHRlcm1zLlxuICAgKlxuICAgKiBAcGFyYW0ge0V2ZW50fSBlXG4gICAqIEBhcGkgcHJpdmF0ZVxuICAgKi9cbiAgRGF3bi5wcm90b3R5cGUuc2VhcmNoID0gZnVuY3Rpb24gc2VhcmNoKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICB2YXIgdiA9IHRoaXMuc2VhcmNoYm94LnZhbHVlXG4gICAgICAsIGkgPSB0aGlzLmFydGljbGVzLmxlbmd0aFxuICAgICAgLCByZWdleHAgPSBuZXcgUmVnRXhwKCcoJyArIHYgKyAnKScsICdpZycpXG4gICAgICAsIGFydGljbGUsIGFsbCwgbjtcblxuICAgIC8vIE9ubHkgc2VhcmNoIGFnYWluc3QgcHJvcGVyIGlucHV0LlxuICAgIGlmICghdikgcmV0dXJuO1xuXG4gICAgd2hpbGUgKGktLSkge1xuICAgICAgYXJ0aWNsZSA9IHRoaXMuYXJ0aWNsZXNbaV07XG5cbiAgICAgIC8vIE9ubHkgZG8gYSBmdWxsIHNlYXJjaCBvbiBlYWNoIGNoaWxkIGlmIGl0IGlzIHBhcnQgb2YgdGhlIGNvbnRlbnQuXG4gICAgICBpZiAoIXJlZ2V4cC50ZXN0KHRoaXMudGV4dChhcnRpY2xlKSkpIGNvbnRpbnVlO1xuXG4gICAgICBhbGwgPSBhcnRpY2xlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCcqJyk7XG4gICAgICBuID0gYWxsLmxlbmd0aDtcblxuICAgICAgd2hpbGUgKG4tLSkge1xuICAgICAgICBhbGxbbl0uaW5uZXJIVE1MID0gdGhpcy50ZXh0KGFsbFtuXSkucmVwbGFjZShyZWdleHAsICc8bWFyaz4kMTwvbWFyaz4nKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIFJlbmRlciB0aGUgdmFyaW91cyBlbGVtZW50cyBvbiB0aGUgcGFnZS5cbiAgICpcbiAgICogQGFwaSBwcml2YXRlXG4gICAqL1xuICBEYXduLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiByZW5kZXIoKSB7XG4gICAgdGhpcy5yZXNldCgpLmF0b21pYy51cGRhdGUodGhpcy5hdG9taWMucmFkaW9bdGhpcy5pbmRleF0udmFsdWUpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBVcGRhdGUgdGhlIGN1cnJlbnQgc3RlcC5cbiAgICpcbiAgICogQHBhcmFtIHtOdW1iZXJ9IG4gc3RlcCBudW1iZXJcbiAgICogQGFwaSBwcml2YXRlXG4gICAqL1xuICBEYXduLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiB1cGRhdGUobikge1xuICAgIHRoaXMucmVzZXQoKTtcbiAgICB0aGlzLmluZGV4ID0gbjtcbiAgfTtcblxuICAvKipcbiAgICogR28gdG8gdGhlIHByZXZpb3VzIHN0ZXAuXG4gICAqXG4gICAqIEBwYXJhbSB7RXZlbnR9IGVcbiAgICogQGFwaSBwcml2YXRlXG4gICAqL1xuICBEYXduLnByb3RvdHlwZS5wcmV2aW91cyA9IGZ1bmN0aW9uIHByZXZpb3VzKGUpIHtcbiAgICBpZiAoLS10aGlzLmluZGV4IDwgMCkgdGhpcy5pbmRleCA9IDA7XG4gICAgdGhpcy5yZW5kZXIoKTtcbiAgfTtcblxuICAvKipcbiAgICogR28gdG8gdGhlIG5leHQgc3RlcC5cbiAgICpcbiAgICogQHBhcmFtIHtFdmVudH0gZVxuICAgKiBAYXBpIHByaXZhdGVcbiAgICovXG4gIERhd24ucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiBuZXh0KGUpIHtcbiAgICBpZiAoKyt0aGlzLmluZGV4ID4gdGhpcy5tYXgpIHRoaXMuaW5kZXggPSB0aGlzLm1heDtcbiAgICB0aGlzLnJlbmRlcigpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBUb2dnbGUgdGhlIG5hdmlnYXRpb24gdmlzaWJpbGl0eS5cbiAgICpcbiAgICogQHBhcmFtIHtFdmVudH0gZVxuICAgKiBAYXBpIHByaXZhdGVcbiAgICovXG4gIERhd24ucHJvdG90eXBlLnRvZ2dsZSA9IGZ1bmN0aW9uIHRvZ2dsZShlKSB7XG4gICAgaWYgKGQuYWN0aXZlRWxlbWVudCA9PT0gdGhpcy5zZWFyY2hib3gpIHJldHVybjtcbiAgICB0aGlzLnNldENsYXNzKH50aGlzLnZpZXdwb3J0LmdldEF0dHJpYnV0ZSgnY2xhc3MnKS5pbmRleE9mKCdoaWRlJykgPyAnJyA6ICdoaWRlJyk7XG4gIH07XG5cbiAgLyoqXG4gICAqIFNldCBhIHNwZWNpZmljIGNsYXNzIG9uIHRoZSB2aWV3cG9ydC5cbiAgICpcbiAgICogQHJldHVybnMge0Rhd259IGZsdWVudCBpbnRlcmZhY2VcbiAgICogQGFwaSBwcml2YXRlXG4gICAqL1xuICBEYXduLnByb3RvdHlwZS5zZXRDbGFzcyA9IGZ1bmN0aW9uIHNldENsYXNzKGNsYXNzTmFtZSkge1xuICAgIHRoaXMudmlld3BvcnQuc2V0QXR0cmlidXRlKCdjbGFzcycsICdkYXduICcgKyBjbGFzc05hbWUpO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8qKlxuICAgKiBUb2dnbGUgdGhlIG5hdmlnYXRpb24vaW50cm8uXG4gICAqXG4gICAqIEBwYXJhbSB7RXZlbnR9IGVcbiAgICogQGFwaSBwcml2YXRlXG4gICAqL1xuICBEYXduLnByb3RvdHlwZS5uYXYgPSBmdW5jdGlvbiBuYXYoZSkge1xuICAgIGlmIChkLmFjdGl2ZUVsZW1lbnQgPT09IHRoaXMuc2VhcmNoYm94KSByZXR1cm47XG4gICAgdGhpcy5zZXRDbGFzcyh+dGhpcy52aWV3cG9ydC5nZXRBdHRyaWJ1dGUoJ2NsYXNzJykuaW5kZXhPZignbmF2JykgPyAnJyA6ICduYXYnKTtcbiAgfTtcblxuICAvKipcbiAgICogRm9jdXMgdGhlIHNlYXJjaCBib3guXG4gICAqXG4gICAqIEBwYXJhbSB7RXZlbnR9IGVcbiAgICogQGFwaSBwcml2YXRlXG4gICAqL1xuICBEYXduLnByb3RvdHlwZS5mb2N1cyA9IGZ1bmN0aW9uIGZvY3VzKGUpIHtcbiAgICB2YXIgYWN0aXZlID0gZC5hY3RpdmVFbGVtZW50O1xuICAgIGlmIChhY3RpdmUgPT09IHRoaXMuc2VhcmNoYm94IHx8ICF0aGlzLnNlYXJjaGJveCkgcmV0dXJuO1xuXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHRoaXMuc2V0Q2xhc3MoJ25hdicpLnNlYXJjaGJveC5mb2N1cygpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBSZXN0b3JlIHRoZSBzdGF0ZSBhbmQgY2FsbCB0aGUgbWFwcGVkIGZ1bmN0aW9uLlxuICAgKlxuICAgKiBAcmV0dXJucyB7RGF3bn0gZmx1ZW50IGludGVyZmFjZVxuICAgKiBAYXBpIHByaXZhdGVcbiAgICovXG4gIERhd24ucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgdGhpcy5zZWFyY2hib3guYmx1cigpO1xuICAgIHRoaXMudmlld3BvcnQuc2V0QXR0cmlidXRlKCdjbGFzcycsICdkYXduJyk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgLyoqXG4gICAqIExpc3RlbiB0byBrZXlwcmVzc2VzIHRvIGNvbnRyb2wgdGhlIG92ZXJsYXkuXG4gICAqXG4gICAqIEBwYXJhbSB7RXZlbnR9IGVcbiAgICogQGFwaSBwcml2YXRlXG4gICAqL1xuICBEYXduLnByb3RvdHlwZS5ob3RrZXlzID0gZnVuY3Rpb24gaG90a2V5cyhlKSB7XG4gICAgaWYgKG1hcFtlLmtleUNvZGVdKSB0aGlzW21hcFtlLmtleUNvZGVdXS5jYWxsKHRoaXMsIGUpO1xuICB9O1xuXG4gIC8vIEluaXRpYWxpemUgZ2V0dGluZyBzdGFydGVkIGluc3RhbmNlLCBtb3JlIHRoYW4gb25lIGRvZW5zbid0IG1ha2Ugc2Vuc2UuXG4gIERhd24uaW5zdGFuY2UgPSBuZXcgRGF3bihkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdkYXduJylbMF0pO1xuXG4gIC8vIEV4cG9zZSBjb25zdHJ1Y3RvciBhbmQgY3VycmVudCBpbnN0YW5jZXMgdG8gd2luZG93LlxuICB3LkRhd24gPSBEYXduO1xufSkod2luZG93LCBkb2N1bWVudCk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=